<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Marketplace Find of the Month</title>

  <!-- Poppins font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --max-card-width: 520px;
      --swipe-threshold: 50px;
    }

    html, body {
      margin: 0;
      padding: 0;
      font-family: "Poppins", system-ui, -apple-system, Arial, sans-serif;
      background: #f0f2f5;
      color: #1c1e21;
      overflow-x: hidden;
    }

    header {
      background: #1877f2;
      color: #fff;
      text-align: center;
      padding: 20px 12px;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .header-line { font-size: 22px; font-weight: 700; line-height: 1.2; }
    .header-line.sub { font-size: 18px; font-weight: 500; margin-top: 4px; }

    .toolbar {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 10px 12px;
    }
    .btn {
      border: none;
      background: #1877f2;
      color: #fff;
      font-weight: 700;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
    }

    /* ===== Carousel ===== */
    .carousel-shell {
      width: 100vw;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
    }
    .track {
      display: flex;
      transition: transform 0.3s ease;
      will-change: transform;
    }
    .slide {
      flex: 0 0 auto;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 80vw;
      padding: 10px 0;
    }
    .card {
      width: min(95%, var(--max-card-width));
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.12);
      padding: 14px;
      text-align: center;
    }

    .frame {
      width: 100%;
      aspect-ratio: 1206 / 1405;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid #e4e6eb;
      background: #fff;
    }
    .frame img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    .date { font-size: 13px; color: #606770; margin-bottom: 8px; }
    .title { margin-top: 12px; font-size: 18px; font-weight: 700; }
    .vote-btn {
      margin-top: 12px;
      width: 100%;
      border: none;
      padding: 12px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 700;
      background: #42b72a;
      color: #fff;
    }

    /* ===== Grid View ===== */
    .grid {
      display: none;
      padding: 10px 12px 20px;
      gap: 12px;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    }
    .grid-item {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .grid-item .date { margin-bottom: 6px; font-size: 12px; }
    .grid-item .frame { width: 100%; aspect-ratio: 1206 / 1405; border-radius: 8px; }
    .grid-item .title { font-size: 14px; margin-top: 8px; text-align: center; }
    .grid-item .vote-btn { margin-top: 8px; padding: 10px; font-size: 14px; }

    /* ===== Nominations List ===== */
    #nominationsList {
      padding: 20px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.12);
      margin: 20px auto;
      max-width: 600px;
    }
    #nominationsList h2 {
      margin: 0 0 12px;
      font-size: 20px;
      color: #1877f2;
    }
    #nominationsList ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    #nominationsList li {
      margin: 6px 0;
    }

    /* Navigation arrows */
    .arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.3);
      border: none;
      color: #fff;
      font-size: 2rem;
      width: 40px;
      height: 60px;
      cursor: pointer;
      border-radius: 6px;
      z-index: 5;
    }
    .arrow.left { left: 10px; }
    .arrow.right { right: 10px; }
    .hidden { display: none !important; }
    .show-grid { display: grid; }
  </style>
</head>
<body>
  <header>
    <div class="header-line">Facebook Marketplace</div>
    <div class="header-line sub">Find of the Month</div>
  </header>

  <div class="toolbar">
    <button class="btn" onclick="switchView('carousel')">Carousel View</button>
    <button class="btn" onclick="switchView('grid')">Grid View</button>
  </div>

  <!-- Carousel -->
  <section class="carousel-shell" id="carouselShell">
    <button class="arrow left" onclick="prevSlide()">‹</button>
    <div class="track" id="track"></div>
    <button class="arrow right" onclick="nextSlide()">›</button>
  </section>

  <!-- Grid -->
  <section class="grid" id="grid"></section>

  <!-- Nominations -->
  <section id="nominationsList"></section>

  <script>
    const VOTE_KEY = "nominations_2025_08";

    const finds = [
      { date: "Aug 24, 2025", title: "Snickers Cooler", img: "IMG_4824.jpeg" },
      { date: "Aug 25, 2025", title: "Freaky Fish Flip-Flops", img: "IMG_4993.jpeg" },
      { date: "Aug 26, 2025", title: "Old Potty Chair", img: "IMG_5052.jpeg" },
      { date: "Aug 27, 2025", title: "007 Couch", img: "IMG_5078.jpeg" },
      { date: "Aug 28, 2025", title: "Persimmon Fruit", img: "IMG_5124.jpeg" },
      { date: "Aug 29, 2025", title: "Oreo Table", img: "IMG_5125.jpeg" },
      { date: "Aug 30, 2025", title: "Crocodile Piggy Bank", img: "IMG_5076.jpeg" },
      { date: "Aug 31, 2025", title: "M&M Genie", img: "IMG_4994.jpeg" }
    ];

    const track = document.getElementById("track");
    const grid  = document.getElementById("grid");
    const list  = document.getElementById("nominationsList");

    let nominations = JSON.parse(localStorage.getItem(VOTE_KEY)) || [];

    function escapeQuotes(s){
      return String(s).replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    }

    function isNominated(title) {
      return nominations.some(n => n.title === title);
    }

    function toggleNomination(title, img, date) {
      if (isNominated(title)) {
        nominations = nominations.filter(n => n.title !== title);
      } else {
        if (nominations.length >= 10) {
          alert("You can only nominate up to 10 finds!");
          return;
        }
        nominations.push({ title, img, date });
      }
      localStorage.setItem(VOTE_KEY, JSON.stringify(nominations));
      renderCarousel();
      renderGrid();
      renderNominations();
    }

    function renderCarousel() {
      track.innerHTML = finds.map(f => `
        <div class="slide">
          <div class="card">
            <div class="date">${f.date}</div>
            <div class="frame"><img src="${f.img}" alt="${f.title}"></div>
            <div class="title">${f.title}</div>
            <button class="vote-btn" style="background:${isNominated(f.title) ? "#ff6961" : "#42b72a"}"
              onclick="toggleNomination('${escapeQuotes(f.title)}','${escapeQuotes(f.img)}','${escapeQuotes(f.date)}')">
              ${isNominated(f.title) ? "Remove Nomination" : "Nominate"}
            </button>
          </div>
        </div>
      `).join("");
      updateTransform(0);
    }

    function renderGrid() {
      grid.innerHTML = finds.map(f => `
        <div class="grid-item">
          <div class="date">${f.date}</div>
          <div class="frame"><img src="${f.img}" alt="${f.title}"></div>
          <div class="title">${f.title}</div>
          <button class="vote-btn" style="background:${isNominated(f.title) ? "#ff6961" : "#42b72a"}"
            onclick="toggleNomination('${escapeQuotes(f.title)}','${escapeQuotes(f.img)}','${escapeQuotes(f.date)}')">
            ${isNominated(f.title) ? "Remove Nomination" : "Nominate"}
          </button>
        </div>
      `).join("");
    }

    function renderNominations() {
      list.innerHTML = `
        <h2>Your Nominations (${nominations.length}/10)</h2>
        <ul>
          ${nominations.map(n => `<li>✅ ${n.title} <span style="color:#606770;font-size:12px">(${n.date})</span></li>`).join("")}
        </ul>
      `;
    }

    /* ===== Carousel logic ===== */
    let index = 0, startX = 0, currentX = 0, dragging = false, slideWidth = 0;
    const carouselShell= document.getElementById("carouselShell");

    function updateTransform(offsetX = 0){
      const slide = track.children[index];
      if (!slide) return;
      slideWidth = slide.offsetWidth;
      const containerWidth = carouselShell.clientWidth;
      const centerOffset = (containerWidth - slideWidth) / 2;
      track.style.transition = offsetX === 0 ? "transform 0.28s ease-out" : "none";
      track.style.transform = `translateX(${-index * slideWidth + centerOffset + offsetX}px)`;
    }

    function prevSlide(){ if (index > 0){ index--; updateTransform(0); } }
    function nextSlide(){ if (index < finds.length - 1){ index++; updateTransform(0); } }

    function onTouchStart(e){ dragging = true; startX = e.touches[0].clientX; currentX = startX; track.style.transition = "none"; }
    function onTouchMove(e){ if (!dragging) return; const x = e.touches[0].clientX; const delta = x - startX; if (Math.abs(delta) > 5) e.preventDefault(); updateTransform(delta); currentX = x; }
    function onTouchEnd(){ if (!dragging) return; dragging = false; const delta = currentX - startX; if (delta > 50 && index > 0){ index--; } else if (delta < -50 && index < finds.length - 1){ index++; } updateTransform(0); }

    window.prevSlide = prevSlide;
    window.nextSlide = nextSlide;
    window.toggleNomination = toggleNomination;
    window.switchView = function(view){
      if (view === "grid"){
        carouselShell.classList.add("hidden");
        grid.classList.add("show-grid");
      } else {
        grid.classList.remove("show-grid");
        carouselShell.classList.remove("hidden");
        updateTransform();
      }
    };

    (function init(){
      renderCarousel();
      renderGrid();
      renderNominations();

      const carouselEl = document.querySelector('.carousel-shell');
      carouselEl.addEventListener("touchstart", onTouchStart, { passive: false });
      carouselEl.addEventListener("touchmove", onTouchMove,   { passive: false });
      carouselEl.addEventListener("touchend",  onTouchEnd,    { passive: true  });

      window.addEventListener("resize", () => updateTransform(0));
    })();
  </script>
</body>
</html>
