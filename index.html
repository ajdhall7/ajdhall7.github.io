<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Marketplace Find of the Month</title>

  <!-- Poppins font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Max content width for the portrait frame on mobile */
      --max-card-width: 520px;
      /* Slide threshold in px */
      --swipe-threshold: 50px;
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: "Poppins", system-ui, -apple-system, Arial, sans-serif;
      background: #f0f2f5;
      color: #1c1e21;
      overflow-x: hidden;               /* Prevent page side-scroll */
      overscroll-behavior-x: none;      /* Lock horizontal overscroll */
      -webkit-text-size-adjust: 100%;
    }

    header {
      background: #1877f2;
      color: #fff;
      text-align: center;
      padding: 16px 12px;
      font-size: 20px;
      font-weight: 700;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .toolbar {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 10px 12px;
    }
    .btn {
      border: none;
      background: #1877f2;
      color: #fff;
      font-weight: 700;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
    }

    /* ===== Carousel (Swipe) ===== */
    .carousel-shell {
      width: 100%;
      display: block;
    }
    .carousel {
      width: 100%;
      overflow: hidden;                 /* Track slides; we manage movement via transform */
      display: block;
    }
    .track {
      display: flex;
      will-change: transform;
      transition: transform 0.28s ease-out;
      touch-action: pan-y;              /* Allow vertical scroll, we handle horizontal */
    }

    .slide {
      flex: 0 0 100%;
      display: flex;
      justify-content: center;
      padding: 10px 0 18px;
    }

    .card {
      width: min(95vw, var(--max-card-width));
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.12);
      padding: 14px;
      text-align: center;
    }

    .date {
      font-size: 13px;
      color: #606770;
      margin-bottom: 8px;
    }

    /* Fixed portrait frame: EXACT 1206 x 1405 aspect box */
    .frame {
      width: 100%;
      aspect-ratio: 1206 / 1405;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid #e4e6eb;
    }
    .frame img {
      width: 100%;
      height: 100%;
      object-fit: contain;  /* No cropping; fits inside the 1206x1405 box */
      display: block;
    }

    .title {
      margin-top: 12px;
      font-size: 18px;
      font-weight: 700;
    }

    .vote-btn {
      margin-top: 12px;
      width: 100%;
      border: none;
      padding: 12px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 700;
      background: #42b72a;
      color: #fff;
    }

    /* ===== Grid View ===== */
    .grid {
      display: none;
      padding: 10px 12px 20px;
      gap: 12px;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    }
    .grid-item {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .grid-item .date {
      margin-bottom: 6px;
      font-size: 12px;
    }
    .grid-item .frame {
      width: 100%;
      aspect-ratio: 1206 / 1405;
      border-radius: 8px;
    }
    .grid-item .title {
      font-size: 14px;
      margin-top: 8px;
      text-align: center;
    }
    .grid-item .vote-btn {
      margin-top: 8px;
      padding: 10px;
      font-size: 14px;
    }

    /* ===== Results Screen ===== */
    .results {
      display: none;
      padding: 18px 12px 28px;
      text-align: center;
    }
    .results-card {
      width: min(95vw, var(--max-card-width));
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.12);
      padding: 16px;
    }
    .results h2 {
      font-size: 18px;
      color: #1877f2;
      font-weight: 700;
      margin: 0 0 10px;
    }
    .results .title {
      margin: 10px 0 14px;
    }
    .results .frame {
      margin: 0 auto;
    }

    /* Utilities (hidden states) */
    .hidden { display: none !important; }
    .show-grid { display: grid; }
  </style>
</head>
<body>
  <header>Facebook Marketplace Find of the Month</header>

  <div class="toolbar">
    <button class="btn" onclick="switchView('carousel')">Carousel View</button>
    <button class="btn" onclick="switchView('grid')">Grid View</button>
  </div>

  <!-- Carousel -->
  <section class="carousel-shell" id="carouselShell">
    <div class="carousel">
      <div class="track" id="track"></div>
    </div>
  </section>

  <!-- Grid -->
  <section class="grid" id="grid"></section>

  <!-- Results -->
  <section class="results" id="results">
    <div class="results-card">
      <h2>Your Facebook Marketplace Find of the Month:</h2>
      <div class="title" id="chosenTitle"></div>
      <div class="frame">
        <img id="chosenImage" alt="Selected Find">
      </div>
    </div>
  </section>

  <script>
    /* ============ CONFIG ============ */
    // Update this key each month (e.g., "vote_2025_08") if you want to reset voting without clearing the browser.
    const VOTE_KEY = "vote_2025_08";

    // Add your finds here (date, title, img)
    const finds = [
      { date: "Aug 1, 2025", title: "Vintage Bike", img: "find1.jpg" },
      { date: "Aug 2, 2025", title: "Retro Couch", img: "find2.jpg" },
      { date: "Aug 3, 2025", title: "Industrial Lamp", img: "find3.jpg" },
      // ... add more up to ~30 for the month
    ];

    /* ============ ELEMENTS ============ */
    const track = document.getElementById("track");
    const carouselShell = document.getElementById("carouselShell");
    const grid = document.getElementById("grid");
    const results = document.getElementById("results");
    const chosenTitle = document.getElementById("chosenTitle");
    const chosenImage = document.getElementById("chosenImage");

    /* ============ RENDERING ============ */
    function renderCarousel() {
      track.innerHTML = finds.map(f => `
        <div class="slide">
          <div class="card">
            <div class="date">${f.date}</div>
            <div class="frame">
              <img src="${f.img}" alt="${f.title}">
            </div>
            <div class="title">${f.title}</div>
            <button class="vote-btn" onclick="vote('${escapeQuotes(f.title)}','${escapeQuotes(f.img)}')">Vote for this Find</button>
          </div>
        </div>
      `).join("");
      updateTransform();
    }

    function renderGrid() {
      grid.innerHTML = finds.map(f => `
        <div class="grid-item">
          <div class="date">${f.date}</div>
          <div class="frame">
            <img src="${f.img}" alt="${f.title}">
          </div>
          <div class="title">${f.title}</div>
          <button class="vote-btn" onclick="vote('${escapeQuotes(f.title)}','${escapeQuotes(f.img)}')">Vote</button>
        </div>
      `).join("");
    }

    /* ============ VIEW TOGGLE ============ */
    function switchView(view){
      if (view === "grid"){
        carouselShell.classList.add("hidden");
        grid.classList.add("show-grid");
        results.classList.add("hidden");
      } else {
        grid.classList.remove("show-grid");
        results.classList.add("hidden");
        carouselShell.classList.remove("hidden");
        updateTransform(); // keep slide position correct
      }
    }

    /* ============ VOTING ============ */
    function vote(title, img){
      localStorage.setItem(VOTE_KEY, JSON.stringify({ title, img }));
      showResults();
    }

    function showResults(){
      const saved = localStorage.getItem(VOTE_KEY);
      if (!saved) return;
      const { title, img } = JSON.parse(saved);
      chosenTitle.textContent = title;
      chosenImage.src = img;

      // Show results
      carouselShell.classList.add("hidden");
      grid.classList.remove("show-grid");
      grid.classList.add("hidden");
      results.classList.remove("hidden");
    }

    /* ============ SWIPE / SLIDE LOGIC ============ */
    let index = 0;
    let startX = 0;
    let currentX = 0;
    let dragging = false;
    let trackWidth = 0;

    function updateTransform(offsetX = 0){
      const containerWidth = document.body.clientWidth; // viewport width for slide width
      track.style.transition = offsetX === 0 ? "transform 0.28s ease-out" : "none";
      track.style.transform = `translateX(${-(index * containerWidth) + offsetX}px)`;
    }

    function onTouchStart(e){
      // If already voted/results showing, ignore
      if (!carouselShell || carouselShell.classList.contains("hidden")) return;

      dragging = true;
      startX = e.touches[0].clientX;
      currentX = startX;
      track.style.transition = "none";
    }
    function onTouchMove(e){
      if (!dragging) return;
      const x = e.touches[0].clientX;
      const delta = x - startX;

      // prevent page horizontal scroll while dragging
      if (Math.abs(delta) > 5) e.preventDefault();

      // slight resistance at bounds
      const atStart = index === 0 && delta > 0;
      const atEnd = index === finds.length - 1 && delta < 0;
      const damp = (atStart || atEnd) ? 0.35 : 1;

      updateTransform(delta * damp);
      currentX = x;
    }
    function onTouchEnd(){
      if (!dragging) return;
      dragging = false;

      const delta = currentX - startX;
      if (delta > parseInt(getComputedStyle(document.documentElement).getPropertyValue('--swipe-threshold')) && index > 0){
        index--;
      } else if (delta < -parseInt(getComputedStyle(document.documentElement).getPropertyValue('--swipe-threshold')) && index < finds.length - 1){
        index++;
      }
      updateTransform(0);
    }

    /* ============ HELPERS ============ */
    function escapeQuotes(s){
      return String(s).replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    }

    function resize(){
      // Keep current slide aligned on rotation/resize
      updateTransform(0);
    }

    /* ============ INIT ============ */
    (function init(){
      // If already voted, go straight to results
      if (localStorage.getItem(VOTE_KEY)) {
        renderCarousel();
        renderGrid();
        showResults();
      } else {
        renderCarousel();
        renderGrid();
        switchView("carousel");
      }

      // Touch events for swipe
      const carouselEl = document.querySelector('.carousel');
      carouselEl.addEventListener("touchstart", onTouchStart, { passive: false });
      carouselEl.addEventListener("touchmove", onTouchMove, { passive: false });
      carouselEl.addEventListener("touchend", onTouchEnd, { passive: false });

      window.addEventListener("resize", resize);
    })();
  </script>
</body>
</html>
